# mmlabc-to-smf

Music Macro Language (MML) to Standard MIDI File (SMF) Converter

<p align="left">
  <a href="README.ja.md"><img src="https://img.shields.io/badge/ðŸ‡¯ðŸ‡µ-Japanese-red.svg" alt="Japanese"></a>
  <a href="README.md"><img src="https://img.shields.io/badge/ðŸ‡ºðŸ‡¸-English-blue.svg" alt="English"></a>
</p>

## Overview

This project converts Music Macro Language format strings into Standard MIDI Files using a 4-pass architecture with comprehensive debug output.

## Features

- **4-Pass Architecture**: 
  - Pass 1: Parse MML string into tokens (outputs `pass1_tokens.json`)
  - Pass 2: Convert tokens to Abstract Syntax Tree (outputs `pass2_ast.json`)
  - Pass 3: Generate MIDI events from AST (outputs `pass3_events.json`)
  - Pass 4: Create Standard MIDI File (outputs `.mid` file)
- **Debug JSON Output**: Each pass saves intermediate results as JSON for debugging
- **Test-Driven Development**: Comprehensive test suite with unit and integration tests
- **Modular Design**: Each pass is implemented in ~100 lines or less per file

## Requirements

- Python 3.8 or higher
- mido (Python MIDI library)

## Installation

```bash
pip install -r requirements.txt
```

## Usage

### Basic Usage

```bash
python mml_to_smf.py "cde"
```

This converts the MML string "cde" (notes C, D, E) into:
- MIDI notes 60, 62, 64 (Middle C, D, E)
- Output file: `output.mid`
- Debug files: `pass1_tokens.json`, `pass2_ast.json`, `pass3_events.json`

### Custom Output File

```bash
python mml_to_smf.py "cde" -o my_song.mid
```

### Supported Notes

Currently supports basic note names: `c`, `d`, `e`, `f`, `g`, `a`, `b`

## Example

```bash
$ python mml_to_smf.py "cde"
Converting MML: cde
Pass 1: Parsing MML...
  Generated 3 tokens â†’ pass1_tokens.json
Pass 2: Creating AST...
  Generated AST with 3 notes â†’ pass2_ast.json
Pass 3: Creating MIDI events...
  Generated 6 events â†’ pass3_events.json
Pass 4: Creating MIDI file...
  Generated MIDI file â†’ output.mid

Conversion complete!
Output files:
  - pass1_tokens.json (debug)
  - pass2_ast.json (debug)
  - pass3_events.json (debug)
  - output.mid (final output)
```

## Project Structure

```
mmlabc-to-smf/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pass1_parser.py    # Pass 1: MML parsing
â”‚   â”œâ”€â”€ pass2_ast.py        # Pass 2: AST creation
â”‚   â”œâ”€â”€ pass3_events.py     # Pass 3: Event generation
â”‚   â””â”€â”€ pass4_midi.py       # Pass 4: MIDI file creation
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_pass1.py       # Unit tests for Pass 1
â”‚   â”œâ”€â”€ test_pass2.py       # Unit tests for Pass 2
â”‚   â”œâ”€â”€ test_pass3.py       # Unit tests for Pass 3
â”‚   â”œâ”€â”€ test_pass4.py       # Unit tests for Pass 4
â”‚   â””â”€â”€ test_integration.py # Integration tests
â”œâ”€â”€ mml_to_smf.py          # Main CLI script
â”œâ”€â”€ requirements.txt        # Python dependencies
â””â”€â”€ README.md              # This file
```

## Testing

Run all tests:

```bash
python -m unittest discover -s tests -p "test_*.py" -v
```

Run specific test file:

```bash
python -m unittest tests.test_integration
```

## Development

This project follows Test-Driven Development (TDD) principles:

1. Each module is kept under ~100 lines
2. Each pass has corresponding unit tests
3. Integration tests verify the complete pipeline
4. Debug JSON output at each stage for troubleshooting

## License

See LICENSE file for details.

â€» The English version README.md will be automatically generated by AI translation based on README.ja.md in the future.